version: "3.9"
services:
  db:
    image: postgres:16-alpine
    environment:
      - POSTGRES_USER=root
      - POSTGRES_PASSWORD=secret
      - POSTGRES_DB=streamfair_user_service_db
    ports:
      - "5436:5432"
    networks:
      - db_access_network

  api:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "9590:9094"
      - "8580:8084"
    environment:
      - DB_SOURCE_USER_SERVICE=postgresql://root:secret@db:5432/streamfair_user_service_db?sslmode=disable
      - HTTP_SERVER_ADDRESS_USER_SERVICE=0.0.0.0:8084
      - GRPC_SERVER_ADDRESS_USER_SERVICE=0.0.0.0:9094
      - TOKEN_SYMMETRIC_KEY=12345678901234567890123456789012
      - ACCESS_TOKEN_DURATION=15m
      - REFRESH_TOKEN_DURATION=24h
    depends_on:
      - db
    networks:
      - streamfair_internal_network
      - db_access_network
    entrypoint: [ "/streamfair_user_svc/wait-for.sh", "db:5432", "--", "/streamfair_user_svc/start.sh" ]
    command: [ "/streamfair_user_svc/user_svc" ]

networks:
  db_access_network:
    driver: bridge
  streamfair_internal_network:
    external: true